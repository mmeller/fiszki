<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fiszki - Language Learning App</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
      .auth-panel {
        position: absolute;
        top: 20px;
        right: 180px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      
      .user-info {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 16px;
        background: rgba(255,255,255,0.1);
        border-radius: 20px;
        color: white;
        font-size: 14px;
      }
      
      .sync-status {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #48bb78;
      }
      
      .sync-status.syncing {
        background: #ed8936;
        animation: pulse 1.5s infinite;
      }
      
      .sync-status.offline {
        background: #718096;
      }
      
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }
      
      .btn-auth {
        padding: 8px 16px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
        display: inline-block;
      }
      
      .btn-signin {
        background: rgba(255,255,255,0.2);
        color: white;
      }
      
      .btn-signin:hover {
        background: rgba(255,255,255,0.3);
      }
      
      .btn-signout {
        background: rgba(239, 68, 68, 0.8);
        color: white;
        border: none;
      }
      
      .btn-signout:hover {
        background: rgba(220, 38, 38, 0.9);
      }
      
      .sync-mode-selector {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: white;
        padding: 12px 16px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        font-size: 13px;
        z-index: 1000;
      }
      
      .sync-mode-selector select {
        margin-left: 8px;
        padding: 4px 8px;
        border: 1px solid #e2e8f0;
        border-radius: 4px;
        font-size: 13px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üéì Fiszki - Language Learning</h1>
        
        <!-- Authentication Panel -->
        <div class="auth-panel" id="auth-panel">
          <div id="auth-signed-out" style="display: none;">
            <a href="auth.html" class="btn-auth btn-signin">Sign In</a>
          </div>
          <div id="auth-signed-in" style="display: none;">
            <div class="user-info">
              <span class="sync-status" id="sync-status" title="Sync status"></span>
              <span id="user-email"></span>
            </div>
            <button class="btn-auth btn-signout" id="signout-btn">Sign Out</button>
          </div>
        </div>
        
        <a
          href="categories.html"
          class="btn btn-secondary"
          style="
            position: absolute;
            top: 20px;
            right: 20px;
            text-decoration: none;
          "
          >üìö Manage Categories</a
        >
      </header>

      <nav class="tabs">
        <button class="tab-button active" data-tab="import">
          Import Words
        </button>
        <button class="tab-button" data-tab="flashcards">Flashcards</button>
        <button class="tab-button" data-tab="list">Word List</button>
        <button class="tab-button" data-tab="test">Create Test</button>
      </nav>

      <!-- Import Tab -->
      <div id="import-tab" class="tab-content active">
        <div class="section">
          <h2>Import Words from CSV</h2>

          <div
            class="category-selector"
            style="
              margin-bottom: 20px;
              padding: 15px;
              background: #f7fafc;
              border-radius: 8px;
            "
          >
            <label style="display: block; margin-bottom: 10px; font-weight: 600"
              >Select Category:</label
            >
            <div style="display: flex; gap: 10px; align-items: center">
              <select
                id="category-select"
                style="
                  flex: 1;
                  padding: 10px;
                  border: 2px solid #e2e8f0;
                  border-radius: 8px;
                  font-size: 14px;
                "
              >
                <option value="">Loading categories...</option>
              </select>
              <button
                id="new-category-btn"
                class="btn btn-secondary"
                style="white-space: nowrap"
              >
                ‚ûï New Category
              </button>
            </div>
          </div>

          <p class="info">
            Upload a CSV file with word pairs. The app will detect columns based
            on the header row.
            <br /><strong>Example with header:</strong> <br /><code
              >Polish | Polish_spelling | English | English_spelling</code
            >
            <br /><code>Dzie≈Ñ dobry | | Hello | </code> <br /><br /><strong
              >Supported formats:</strong
            >
            <br />‚Ä¢ With header: Language names, "word", "pronunciation",
            "spelling", etc. <br />‚Ä¢ Without header: 2-4 columns (auto-detected)
            <br />‚Ä¢ Pronunciations/spellings are optional (can be empty columns)
          </p>
          <p>
            <a
              href="https://raw.githubusercontent.com/mmeller/fiszki/refs/heads/main/unit1.csv"
              download
              target="_blank"
              >Unit 1</a
            >
            <a
              href="https://drive.google.com/drive/folders/1S0-hq4oLpNMj__dZOqC34eq_-NZXkwli?usp=drive_link"
              target="_blank"
              >Sample CSV Files</a
            >
          </p>

          <div class="upload-area">
            <input type="file" id="csv-file" accept=".csv" />
            <button id="import-btn" class="btn btn-primary">Import CSV</button>
          </div>

          <div id="import-status" class="status"></div>

          <div class="manual-add">
            <h3>Or Add Words Manually</h3>
            <div class="form-group">
              <input type="text" id="word1" placeholder="Language 1 word" />
              <input
                type="text"
                id="pronunciation1"
                placeholder="Pronunciation 1 (optional)"
              />
            </div>
            <div class="form-group">
              <input type="text" id="word2" placeholder="Language 2 word" />
              <input
                type="text"
                id="pronunciation2"
                placeholder="Pronunciation 2 (optional)"
              />
            </div>
            <button id="add-word-btn" class="btn btn-secondary">
              Add Word Pair
            </button>
          </div>

          <div class="stats">
            <p>Total words in database: <strong id="word-count">0</strong></p>
            <button id="clear-db-btn" class="btn btn-danger">
              Clear All Words
            </button>
          </div>
        </div>
      </div>

      <!-- Flashcards Tab -->
      <div id="flashcards-tab" class="tab-content">
        <div class="section">
          <h2>Flashcards</h2>

          <div
            class="category-filter"
            style="
              margin-bottom: 20px;
              padding: 15px;
              background: #f7fafc;
              border-radius: 8px;
            "
          >
            <label style="display: block; margin-bottom: 10px; font-weight: 600"
              >Filter by Category:</label
            >
            <select
              id="flashcard-category-filter"
              style="
                width: 100%;
                padding: 10px;
                border: 2px solid #e2e8f0;
                border-radius: 8px;
                font-size: 14px;
              "
            >
              <option value="all">All Categories</option>
            </select>
          </div>

          <div id="flashcard-container">
            <div id="no-words-message" class="message">
              No words available. Please import words first.
            </div>

            <div id="flashcard-area" class="hidden">
              <div class="flashcard" id="flashcard">
                <div class="flashcard-inner">
                  <div class="flashcard-front">
                    <div class="word" id="front-word"></div>
                    <div class="pronunciation" id="front-pronunciation"></div>
                  </div>
                  <div class="flashcard-back">
                    <div class="word" id="back-word"></div>
                    <div class="pronunciation" id="back-pronunciation"></div>
                  </div>
                </div>
              </div>

              <p class="hint">Click the card to flip</p>

              <div class="flashcard-controls">
                <button id="prev-card" class="btn btn-secondary">
                  ‚Üê Previous
                </button>
                <span class="card-counter">
                  Card <span id="current-card">1</span> of
                  <span id="total-cards">0</span>
                </span>
                <button id="next-card" class="btn btn-secondary">Next ‚Üí</button>
              </div>

              <div class="flashcard-options">
                <label>
                  <input type="checkbox" id="shuffle-cards" />
                  Shuffle cards
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- List Tab -->
      <div id="list-tab" class="tab-content">
        <div class="section">
          <h2>Word List</h2>

          <div
            class="category-filter"
            style="
              margin-bottom: 20px;
              padding: 15px;
              background: #f7fafc;
              border-radius: 8px;
            "
          >
            <label style="display: block; margin-bottom: 10px; font-weight: 600"
              >Filter by Category:</label
            >
            <select
              id="list-category-filter"
              style="
                width: 100%;
                padding: 10px;
                border: 2px solid #e2e8f0;
                border-radius: 8px;
                font-size: 14px;
              "
            >
              <option value="all">All Categories</option>
            </select>
          </div>

          <div id="word-list-container">
            <div id="no-words-list-message" class="message">
              No words available. Please import words first.
            </div>

            <div
              id="word-list-actions"
              class="hidden"
              style="
                margin-bottom: 15px;
                display: flex;
                gap: 10px;
                align-items: center;
              "
            >
              <button id="select-all-words-btn" class="btn btn-secondary">
                Select All
              </button>
              <button id="deselect-all-words-btn" class="btn btn-secondary">
                Deselect All
              </button>
              <button id="delete-selected-words-btn" class="btn btn-danger">
                Delete Selected
              </button>
              <span
                id="selected-count"
                style="margin-left: 10px; font-weight: 600; color: #4a5568"
              ></span>
            </div>

            <div id="word-list" class="word-list"></div>
          </div>
        </div>
      </div>

      <!-- Test Tab -->
      <div id="test-tab" class="tab-content">
        <div class="section">
          <h2>Create a Test</h2>

          <div
            class="category-filter"
            style="
              margin-bottom: 20px;
              padding: 15px;
              background: #f7fafc;
              border-radius: 8px;
            "
          >
            <label style="display: block; margin-bottom: 10px; font-weight: 600"
              >Filter by Category:</label
            >
            <select
              id="test-category-filter"
              style="
                width: 100%;
                padding: 10px;
                border: 2px solid #e2e8f0;
                border-radius: 8px;
                font-size: 14px;
              "
            >
              <option value="all">All Categories</option>
            </select>
          </div>

          <div id="test-setup" class="test-setup">
            <div id="no-words-test-message" class="message">
              No words available. Please import words first.
            </div>

            <div id="test-config-area" class="hidden">
              <h3>Select Words for Test</h3>
              <div class="selection-controls">
                <button id="select-all-btn" class="btn btn-secondary">
                  Select All
                </button>
                <button id="deselect-all-btn" class="btn btn-secondary">
                  Deselect All
                </button>
              </div>

              <div id="word-selection-list" class="word-selection-list"></div>

              <div class="test-options">
                <h3>Test Settings</h3>

                <div class="option-group">
                  <label>Test Direction:</label>
                  <div class="radio-group">
                    <label>
                      <input
                        type="radio"
                        name="test-direction"
                        value="lang1-to-lang2"
                        checked
                      />
                      Language 1 ‚Üí Language 2
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="test-direction"
                        value="lang2-to-lang1"
                      />
                      Language 2 ‚Üí Language 1
                    </label>
                    <label>
                      <input type="radio" name="test-direction" value="mixed" />
                      Mixed (Both Directions)
                    </label>
                  </div>
                </div>

                <div class="option-group">
                  <label>Test Type:</label>
                  <div class="radio-group">
                    <label>
                      <input
                        type="radio"
                        name="test-type"
                        value="multiple-choice"
                        checked
                      />
                      Multiple Choice
                    </label>
                    <label>
                      <input type="radio" name="test-type" value="text-input" />
                      Text Input
                    </label>
                  </div>
                </div>

                <div class="option-group" id="choice-count-option">
                  <label for="choice-count">Number of choices:</label>
                  <select id="choice-count">
                    <option value="3">3</option>
                    <option value="4" selected>4</option>
                    <option value="5">5</option>
                  </select>
                </div>
              </div>

              <button id="start-test-btn" class="btn btn-primary btn-large">
                Start Test
              </button>
            </div>
          </div>

          <div id="test-area" class="test-area hidden">
            <div class="test-header">
              <div class="test-progress">
                Question <span id="current-question">1</span> of
                <span id="total-questions">0</span>
              </div>
              <div class="test-score">
                Score: <span id="test-score">0</span> /
                <span id="test-total">0</span>
              </div>
            </div>

            <div class="question-card">
              <div class="question-text" id="question-text"></div>
              <div
                class="question-pronunciation"
                id="question-pronunciation"
              ></div>
            </div>

            <div id="multiple-choice-area" class="answer-area">
              <div id="choices" class="choices"></div>
            </div>

            <div id="text-input-area" class="answer-area hidden">
              <input
                type="text"
                id="answer-input"
                class="answer-input"
                placeholder="Type your answer..."
              />
              <button id="submit-answer-btn" class="btn btn-primary">
                Submit Answer
              </button>
            </div>

            <div id="feedback" class="feedback hidden"></div>

            <button id="next-question-btn" class="btn btn-secondary hidden">
              Next Question
            </button>
            <button
              id="finish-test-btn"
              class="btn btn-primary btn-large hidden"
            >
              Finish Test
            </button>
          </div>

          <div id="test-results" class="test-results hidden">
            <h2>Test Results</h2>
            <div class="results-summary">
              <div class="result-stat">
                <div class="stat-value" id="final-score">0</div>
                <div class="stat-label">Score</div>
              </div>
              <div class="result-stat">
                <div class="stat-value" id="final-percentage">0%</div>
                <div class="stat-label">Percentage</div>
              </div>
              <div class="result-stat">
                <div class="stat-value" id="final-correct">0</div>
                <div class="stat-label">Correct</div>
              </div>
              <div class="result-stat">
                <div class="stat-value" id="final-wrong">0</div>
                <div class="stat-label">Wrong</div>
              </div>
            </div>

            <div id="results-details" class="results-details"></div>

            <button id="new-test-btn" class="btn btn-primary btn-large">
              Create New Test
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Sync Mode Selector (only shown when signed in) -->
    <div class="sync-mode-selector" id="sync-mode-selector" style="display: none;">
      <label>
        üîÑ Sync Mode:
        <select id="sync-mode-select">
          <option value="auto">Auto (Immediate)</option>
          <option value="manual">Manual</option>
          <option value="offline-only">Offline Only</option>
        </select>
      </label>
    </div>

    <!-- Load Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Load app scripts -->
    <script src="config.js"></script>
    <script src="database.js"></script>
    <script src="supabase-db.js"></script>
    <script src="sync-manager.js"></script>
    <script src="app.js"></script>
  </body>
</html>
