<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikacja do Nauki Słówek</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .tab-link {
            cursor: pointer;
        }
        .tab-link.active {
            background-color: #6366f1;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="bg-gradient-to-r from-blue-100 to-purple-100 flex justify-center items-center min-h-screen p-4">
    <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-2xl transition-transform hover:scale-105">
        <h1 class="text-2xl font-semibold text-indigo-600 text-center mb-6">Fiszki do Nauki Słówek</h1>
        <div class="flex justify-center mb-4 space-x-4">
            <div id="dictionary-tab" class="tab-link px-5 py-3 rounded-md font-medium text-gray-700 hover:bg-indigo-100 transition-colors">Słowniczek</div>
            <div id="learn-tab" class="tab-link px-5 py-3 rounded-md font-medium text-gray-700 hover:bg-indigo-100 transition-colors">Ucz się</div>
            <div id="known-tab" class="tab-link px-5 py-3 rounded-md font-medium text-gray-700 hover:bg-indigo-100 transition-colors">Znane słówka</div>
            <div id="test-tab" class="tab-link px-5 py-3 rounded-md font-medium text-gray-700 hover:bg-indigo-100 transition-colors">Test</div>
        </div>
        <div id="dictionary-content" class="tab-content active">
            <div class="mb-4">
                <label for="file-input" class="inline-flex items-center justify-center px-5 py-3 bg-indigo-600 text-white font-medium rounded-md shadow-md cursor-pointer hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition-colors">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-11-8l-4-4m0 0l4-4m-4 4h14"></path></svg>
                    <span>Wybierz plik CSV</span>
                    <input id="file-input" type="file" accept=".csv" class="hidden">
                </label>
                <p id="file-name" class="mt-2 text-sm text-gray-500"></p>
                <p id="file-error" class="mt-2 text-sm text-red-500"></p>
            </div>
            <div class="mb-4 flex space-x-4">
                <input type="text" id="front-input" placeholder="Słowo (przód)" class="w-1/2 px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                <div class="flex items-center space-x-2">
                    <input type="text" id="back-input" placeholder="Tłumaczenie (tył)" class="w-1/2 px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    <button id="add-to-dictionary-btn" class="px-3 py-1 bg-green-600 text-white font-medium rounded-md shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm">
                        +
                    </button>
                </div>
            </div>
            <div class="mb-4">
                <input type="text" id="search-input" placeholder="Szukaj słówek..." class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
            </div>
            <div id="word-list-container" class="space-y-2 w-full max-w-md overflow-y-auto max-h-60">
                </div>
            <div class="mt-4">
                <label class="inline-flex items-center">
                    <input type="checkbox" id="select-all-checkbox" class="form-checkbox h-5 w-5 text-indigo-600 rounded">
                    <span class="ml-2 text-gray-700 text-sm">Zaznacz wszystkie</span>
                </label>
            </div>
            <div class="mt-4">
                <button id="add-to-learn-btn" class="px-5 py-3 bg-indigo-600 text-white font-medium rounded-md shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    Dodaj do Ucz się
                </button>
            </div>
        </div>
        <div id="learn-content" class="tab-content hidden">
            <div class="mb-4">
                
            </div>
            <div id="card-container" class="flex flex-col items-center justify-center p-6 rounded-lg bg-gradient-to-br from-indigo-50 to-purple-50 shadow-md">
                <div id="flashcard" class="w-full max-w-md h-64 bg-white rounded-lg shadow-lg flex items-center justify-center text-center text-xl font-semibold px-4 py-6 transition-transform duration-500 cursor-pointer hover:scale-105">
                    <p id="card-text" class="text-gray-800">Front</p>
                </div>
                <div class="flex justify-center mt-6 space-x-4">
                    <button id="prev-btn" class="px-5 py-3 bg-gray-300 text-gray-700 font-medium rounded-md shadow-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-opacity-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        Poprzednie
                    </button>
                    <button id="next-btn" class="px-5 py-3 bg-indigo-600 text-white font-medium rounded-md shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        Następne
                    </button>
                    <button id="mark-known-btn" class="px-5 py-3 bg-green-500 text-white font-medium rounded-md shadow-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-opacity-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        Oznacz jako znane
                    </button>
                </div>
                <div class="mt-4 text-center">
                    <p id="card-count" class="text-sm text-gray-600">Karta 1 z 1</p>
                </div>
            </div>
            <div id="load-indicator" class="mt-6 text-center text-gray-500 hidden">
                <svg class="animate-spin h-5 w-5 mr-3 inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Wczytywanie fiszek...
            </div>
        </div>
        <div id="known-content" class="tab-content hidden">
            <div id="known-cards-list" class="space-y-3 w-full max-w-md">
                </div>
            <div class="mt-4 text-center">
                <button id="reset-known-btn" class="px-5 py-3 bg-red-500 text-white font-medium rounded-md shadow-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    Oznacz wszystkie jako nieznane
                </button>
            </div>
        </div>
        <div id="test-content" class="tab-content hidden">
            <div id="test-controls" class="flex flex-col items-center justify-center p-6 rounded-lg bg-gradient-to-br from-indigo-50 to-purple-50 shadow-md">
                <div id="test-flashcard" class="w-full max-w-md h-64 bg-white rounded-lg shadow-lg flex items-center justify-center text-center text-xl font-semibold px-4 py-6 transition-transform duration-500">
                    <p id="test-card-text" class="text-gray-800">Front</p>
                </div>
                <div class="mt-4 w-full max-w-md">
                    <input type="text" id="test-input" placeholder="Wpisz tłumaczenie" class="w-full px-4 py-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    <p id="test-result" class="mt-2 text-center font-medium"></p>
                </div>
                <div class="flex justify-center mt-6 space-x-4">
                    <button id="test-check-btn" class="px-5 py-3 bg-blue-600 text-white font-medium rounded-md shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        Sprawdź
                    </button>
                    <button id="test-next-btn" class="px-5 py-3 bg-indigo-600 text-white font-medium rounded-md shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        Następne
                    </button>
                    <button id="test-restart-btn" class="px-5 py-3 bg-red-500 text-white font-medium rounded-md shadow-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed hidden">
                        Restart Testu
                    </button>
                </div>
                <div class="mt-4 text-center">
                    <p id="test-card-count" class="text-sm text-gray-600">Pytanie 1 z 1</p>
                </div>
            </div>
            <div id="test-summary" class="w-full max-w-md bg-white rounded-lg shadow-md p-6 mt-8 hidden">
                <h2 class="text-xl font-semibold text-gray-800 text-center mb-4">Podsumowanie Testu</h2>
                <div id="test-summary-content" class="space-y-2">
                    </div>
                <div class="mt-4">
                    <button id="test-restart-btn-summary" class="px-5 py-3 bg-red-500 text-white font-medium rounded-md shadow-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed w-full">
                        Restart Testu
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script>
        const fileInput = document.getElementById('file-input');
        const fileNameDisplay = document.getElementById('file-name');
        const fileErrorDisplay = document.getElementById('file-error');
        const cardContainer = document.getElementById('card-container');
        const flashcard = document.getElementById('flashcard');
        const cardText = document.getElementById('card-text');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const markKnownBtn = document.getElementById('mark-known-btn');
        const cardCountDisplay = document.getElementById('card-count');
        const loadIndicator = document.getElementById('load-indicator');
        const learnTab = document.getElementById('learn-tab');
        const knownTab = document.getElementById('known-tab');
        const dictionaryTab = document.getElementById('dictionary-tab');
        const testTab = document.getElementById('test-tab');
        const learnContent = document.getElementById('learn-content');
        const knownContent = document.getElementById('known-content');
        const dictionaryContent = document.getElementById('dictionary-content');
        const testContent = document.getElementById('test-content');
        const knownCardsList = document.getElementById('known-cards-list');
        const resetKnownBtn = document.getElementById('reset-known-btn');
        const searchInput = document.getElementById('search-input');
        const wordListContainer = document.getElementById('word-list-container');
        const selectAllCheckbox = document.getElementById('select-all-checkbox');
        const addToLearnBtn = document.getElementById('add-to-learn-btn');
        const frontInput = document.getElementById('front-input');
        const backInput = document.getElementById('back-input');
        const addToDictionaryBtn = document.getElementById('add-to-dictionary-btn');
        const testCheckBtn = document.getElementById('test-check-btn');
        const testNextBtn = document.getElementById('test-next-btn');
        const testRestartBtn = document.getElementById('test-restart-btn');
        const testCardText = document.getElementById('test-card-text');
        const testInput = document.getElementById('test-input');
        const testResult = document.getElementById('test-result');
        const testCardCountDisplay = document.getElementById('test-card-count');
        const testControls = document.getElementById('test-controls');
        const testSummary = document.getElementById('test-summary');
        const testSummaryContent = document.getElementById('test-summary-content');
        const testRestartBtnSummary = document.getElementById('test-restart-btn-summary');
        let cardPairs = [];
        let currentCardIndex = 0;
        let isFront = true;
        let knownCards = new Set();
        let currentTab = 'dictionary';
        let selectedWords = new Set();
        let manuallyAddedWords = [];
        let testStarted = false;
        let correctAnswers = 0;
        let currentTestCardIndex = 0;
        let testCards = [];
        let answeredCards = new Set();
        function loadCSV(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function (event) {
                    const text = event.target.result;
                    const lines = text.split('\n').filter(line => line.trim() !== '');
                    const data = lines.map(line => {
                        const parts = line.split('|').map(part => part.trim());
                        return { front: parts[0], back: parts[1] };
                    });
                    resolve(data);
                };
                reader.onerror = function (event) {
                    reject(event.error);
                };
                reader.readAsText(file);
            });
        }
        function displayCard() {
            if (cardPairs.length === 0) {
                cardText.textContent = "Brak fiszek do wyświetlenia. Wybierz plik CSV.";
                cardText.style.cursor = "pointer";
                cardText.onclick = () => {
                    dictionaryTab.click();
                };
                prevBtn.disabled = true;
                nextBtn.disabled = true;
                markKnownBtn.disabled = true;
                cardCountDisplay.textContent = "Karta 0 z 0";
                return;
            } else {
                cardText.style.cursor = "pointer";
                cardText.onclick = () => {
                    isFront = !isFront;
                    displayCard();
                };
            }
            const filteredCards = cardPairs.filter((_, index) => !knownCards.has(index));
            if (filteredCards.length === 0) {
                cardText.textContent = "Wszystkie słówka oznaczone jako znane!";
                prevBtn.disabled = true;
                nextBtn.disabled = true;
                markKnownBtn.disabled = true;
                cardCountDisplay.textContent = "0 z 0";
                return;
            }
            if (currentCardIndex >= filteredCards.length) {
                currentCardIndex = filteredCards.length - 1;
            }
            if (currentCardIndex < 0) {
                currentCardIndex = 0;
            }
            const card = filteredCards[currentCardIndex];
            cardText.textContent = isFront ? card.front : card.back;
            prevBtn.disabled = currentCardIndex === 0;
            nextBtn.disabled = currentCardIndex === filteredCards.length - 1;
            markKnownBtn.disabled = false;
            cardCountDisplay.textContent = `Karta ${currentCardIndex + 1} z ${filteredCards.length}`;
        }
        function displayKnownCards() {
            knownCardsList.innerHTML = '';
            if (knownCards.size === 0) {
                knownCardsList.innerHTML = '<p class="text-gray-500 text-center">Brak oznaczonych słówek.</p>';
                resetKnownBtn.disabled = true;
                return;
            }
            resetKnownBtn.disabled = false;
            knownCards.forEach(index => {
                const card = cardPairs[index];
                const cardItem = document.createElement('div');
                cardItem.className = "flex justify-between items-center bg-gray-100 rounded-md p-4";
                cardItem.innerHTML = `<span class="text-gray-800">${card.front} - ${card.back}</span>
                                     <button class="remove-known-btn px-3 py-1 bg-red-500 text-white rounded-md text-sm hover:bg-red-600 transition-colors" data-index="${index}">Oznacz jako nieznane</button>`;
                knownCardsList.appendChild(cardItem);
            });
        }
        function displayWordList(words) {
            wordListContainer.innerHTML = '';
            const table = document.createElement('table');
            table.className = "w-full text-left";
            table.innerHTML = `
                <thead class="bg-gray-100">
                    <tr>
                        <th class="px-4 py-2"></th>
                        <th class="px-4 py-2">Słowo</th>
                        <th class="px-4 py-2">Tłumaczenie</th>
                    </tr>
                </thead>
                <tbody class="bg-white">
                </tbody>
            `;
            const tbody = table.querySelector('tbody');
            words.forEach((word, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-2"><input type="checkbox" class="word-checkbox form-checkbox h-5 w-5 text-indigo-600 rounded mr-2" data-index="${index}"></td>
                    <td class="px-4 py-2">${word.front}</td>
                    <td class="px-4 py-2">${word.back}</td>
                `;
                tbody.appendChild(row);
            });
            wordListContainer.appendChild(table);
            selectAllCheckbox.checked = false;
            selectedWords.clear();
            addToLearnBtn.disabled = true;
        }
        fileInput.addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (!file) {
                fileNameDisplay.textContent = '';
                fileErrorDisplay.textContent = '';
                cardPairs = [];
                currentCardIndex = 0;
                knownCards.clear();
                cardContainer.classList.add('hidden');
                return;
            }
            if (file.type !== 'text/csv') {
                fileErrorDisplay.textContent = 'Nieprawidłowy typ pliku. Wybierz plik CSV.';
                fileNameDisplay.textContent = '';
                cardPairs = [];
                currentCardIndex = 0;
                knownCards.clear();
                cardContainer.classList.add('hidden');
                return;
            }
            fileNameDisplay.textContent = `Wybrany plik: ${file.name}`;
            fileErrorDisplay.textContent = '';
            cardContainer.classList.remove('hidden');
            loadIndicator.classList.remove('hidden');
            try {
                const csvData = await loadCSV(file);
                cardPairs = [...manuallyAddedWords, ...csvData];
                currentCardIndex = 0;
                isFront = true;
                knownCards.clear();
                selectedWords.clear();
                displayCard();
                displayWordList(cardPairs);
            } catch (error) {
                fileErrorDisplay.textContent = `Błąd odczytu pliku: ${error.message}`;
                fileNameDisplay.textContent = '';
                cardPairs = [];
                currentCardIndex = 0;
                knownCards.clear();
                cardContainer.classList.add('hidden');
            } finally {
                loadIndicator.classList.add('hidden');
            }
        });
        flashcard.addEventListener('click', () => {
            if (cardPairs.length > 0 && currentTab === 'learn') {
                isFront = !isFront;
                displayCard();
            }
        });
        prevBtn.addEventListener('click', () => {
            if (cardPairs.length > 0 && currentTab === 'learn') {
                currentCardIndex--;
                isFront = true;
                displayCard();
            }
        });
        nextBtn.addEventListener('click', () => {
            if (cardPairs.length > 0 && currentTab === 'learn') {
                currentCardIndex++;
                isFront = true;
                displayCard();
            }
        });
        markKnownBtn.addEventListener('click', () => {
            if (cardPairs.length > 0 && currentTab === 'learn') {
                const filteredCards = cardPairs.filter((_, index) => !knownCards.has(index));
                const originalIndex = cardPairs.indexOf(filteredCards[currentCardIndex]);
                knownCards.add(originalIndex);
                if (currentCardIndex < filteredCards.length - 1) {
                    currentCardIndex++;
                } else if (filteredCards.length > 0) {
                    currentCardIndex = 0;
                }
                isFront = true;
                displayCard();
            }
        });
        resetKnownBtn.addEventListener('click', () => {
            knownCards.clear();
            displayKnownCards();
            if (currentTab === 'learn') {
                displayCard();
            }
        });
        knownCardsList.addEventListener('click', (event) => {
            if (event.target.classList.contains('remove-known-btn')) {
                const indexToRemove = parseInt(event.target.dataset.index);
                knownCards.delete(indexToRemove);
                displayKnownCards();
                if (currentTab === 'learn') {
                    displayCard();
                }
            }
        });
        searchInput.addEventListener('input', () => {
            const searchTerm = searchInput.value.toLowerCase();
            const filteredWords = cardPairs.filter(word =>
                word.front.toLowerCase().includes(searchTerm) || word.back.toLowerCase().includes(searchTerm)
            );
            displayWordList(filteredWords);
        });
        selectAllCheckbox.addEventListener('change', () => {
            const wordCheckboxes = document.querySelectorAll('.word-checkbox');
            wordCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
                const index = parseInt(checkbox.dataset.index);
                if (checkbox.checked) {
                    selectedWords.add(index);
                } else {
                    selectedWords.delete(index);
                }
            });
            addToLearnBtn.disabled = selectedWords.size === 0;
        });
        wordListContainer.addEventListener('change', (event) => {
            if (event.target.classList.contains('word-checkbox')) {
                const index = parseInt(event.target.dataset.index);
                if (event.target.checked) {
                    selectedWords.add(index);
                } else {
                    selectedWords.delete(index);
                }
                addToLearnBtn.disabled = selectedWords.size === 0;
                const wordCheckboxes = document.querySelectorAll('.word-checkbox');
                let allChecked = true;
                wordCheckboxes.forEach(checkbox => {
                    if (!checkbox.checked) {
                        allChecked = false;
                    }
                });
                selectAllCheckbox.checked = allChecked;
            }
        });
        addToLearnBtn.addEventListener('click', () => {
            const front = frontInput.value.trim();
            const back = backInput.value.trim();
            if (front && back) {
                const newWord = { front, back };
                const newIndex = cardPairs.length;
                cardPairs.push(newWord);
                selectedWords.forEach(index => {
                    knownCards.add(index);
                });
                selectedWords.add(newIndex);
                selectedWords.clear();
                selectAllCheckbox.checked = false;
                addToLearnBtn.disabled = true;
                displayWordList(cardPairs);
                if (currentTab === 'learn') {
                    displayCard();
                }
                frontInput.value = '';
                backInput.value = '';
            } else {
                alert('Wprowadź słowo i tłumaczenie.');
            }
        });
        addToDictionaryBtn.addEventListener('click', () => {
            const front = frontInput.value.trim();
            const back = backInput.value.trim();
            if (front && back) {
                const newWord = { front, back };
                manuallyAddedWords.push(newWord);
                cardPairs.push(newWord);
                displayWordList(cardPairs);
                frontInput.value = '';
                backInput.value = '';
            } else {
                alert('Wprowadź słowo i tłumaczenie.');
            }
        });
        learnTab.addEventListener('click', () => {
            currentTab = 'learn';
            dictionaryTab.classList.remove('active');
            learnTab.classList.add('active');
            knownTab.classList.remove('active');
            testTab.classList.remove('active');
            dictionaryContent.classList.remove('active');
            learnContent.classList.add('active');
            knownContent.classList.remove('active');
            testContent.classList.remove('active');
            displayCard();
        });
        knownTab.addEventListener('click', () => {
            currentTab = 'known';
            dictionaryTab.classList.remove('active');
            learnTab.classList.remove('active');
            knownTab.classList.add('active');
            dictionaryContent.classList.remove('active');
            learnContent.classList.remove('active');
            knownContent.classList.add('active');
            testContent.classList.remove('active');
            displayKnownCards();
        });
        dictionaryTab.addEventListener('click', () => {
            currentTab = 'dictionary';
            dictionaryTab.classList.add('active');
            learnTab.classList.remove('active');
            knownTab.classList.remove('active');
            testTab.classList.remove('active');
            dictionaryContent.classList.add('active');
            learnContent.classList.remove('active');
            knownContent.classList.remove('active');
            testContent.classList.remove('active');
            displayWordList(cardPairs);
        });
        testTab.addEventListener('click', () => {
            currentTab = 'test';
            dictionaryTab.classList.remove('active');
            learnTab.classList.remove('active');
            knownTab.classList.remove('active');
            testTab.classList.add('active');
            dictionaryContent.classList.remove('active');
            learnContent.classList.remove('active');
            knownContent.classList.remove('active');
            testContent.classList.add('active');
            startTest();
        });
        function startTest() {
            testStarted = true;
            testCards = [...cardPairs];
            currentTestCardIndex = 0;
            correctAnswers = 0;
            answeredCards.clear();
            testSummary.classList.add('hidden');
            testControls.classList.remove('hidden');
            if (testCards.length > 0) {
                // Ensure input is enabled if test starts successfully
                testInput.disabled = false;
                displayTestCard();
            } else {
                testCardText.textContent = "Brak słówek do testowania. Dodaj słówka do słowniczka.";
                testInput.disabled = true;
                testCheckBtn.disabled = true;
                testNextBtn.disabled = true;
                testCardCountDisplay.textContent = "0 z 0";
            }
        }
        function displayTestCard() {
            if (testCards.length === 0) {
                return;
            }
            const card = testCards[currentTestCardIndex];
            testCardText.textContent = isFront ? card.front : card.back;
            testInput.value = '';
            testResult.textContent = '';
            
            // Włącz pole wprowadzania dla nowego pytania
            testInput.disabled = false; 
            
            testCheckBtn.disabled = false;
            testNextBtn.disabled = true;
            testCardCountDisplay.textContent = `Pytanie ${currentTestCardIndex + 1} z ${testCards.length}`;
        }
        testCheckBtn.addEventListener('click', () => {
            if (testCards.length === 0) {
                return;
            }
            const card = testCards[currentTestCardIndex];
            const userAnswer = testInput.value.trim();
            if (userAnswer.toLowerCase() === (isFront ? card.back : card.front).toLowerCase()) {
                testResult.textContent = "OK";
                testResult.className = "mt-2 text-center font-medium text-green-600";
                correctAnswers++;
            } else {
                testResult.textContent = `ŹLE: Poprawnie: ${isFront ? card.back : card.front}`;
                testResult.className = "mt-2 text-center font-medium text-red-600";
            }
            answeredCards.add(currentTestCardIndex);
            
            // Wyłącz pole wprowadzania po sprawdzeniu odpowiedzi
            testInput.disabled = true; 

            testCheckBtn.disabled = true;
            testNextBtn.disabled = false;
        });
        testNextBtn.addEventListener('click', () => {
            if (testCards.length === 0) {
                return;
            }
            if (currentTestCardIndex < testCards.length - 1) {
                currentTestCardIndex++;
                displayTestCard();
            } else {
                endTest();
            }
        });
        function endTest() {
            testStarted = false;
            testControls.classList.add('hidden');
            testSummary.classList.remove('hidden');
            testSummaryContent.innerHTML = `<p class="text-gray-700">Poprawne odpowiedzi: <span class="font-semibold text-blue-600">${correctAnswers} z ${testCards.length}</span></p>`;
            testRestartBtn.classList.remove('hidden');
            testRestartBtnSummary.classList.remove('hidden');
        }
        testRestartBtn.addEventListener('click', () => {
            startTest();
        });
        testRestartBtnSummary.addEventListener('click', () => {
            startTest();
        });
        dictionaryTab.classList.add('active');
        dictionaryContent.classList.add('active');
        learnTab.classList.remove('active');
        learnContent.classList.remove('active');
        knownTab.classList.remove('active');
        knownContent.classList.remove('active');
        testTab.classList.remove('active');
        testContent.classList.remove('active');
    </script>
</body>
</html>
